# AD-Pentesting

**1. Network Enumeration - NMAP** <br>
  `sudo nmap -sC -sV -Pn -A -oA nmap/IP --script=vuln -p- IP -vv`
  - Domain Controller might have port opened like `53,88,135,139,389,445,464,593,636,3268,3269,3389`
  - Note Down the Full Qualified Domain Name, DNS Domain Name, DNS Computer Name and Computer Name with their IP and open ports.
  - Fully Qualified Domain Name: A fully qualified domain name (FQDN) is the complete domain name for a specific computer, or host, on the internet. The FQDN consists of two parts: the hostname and the domain name. For example, an FQDN for a hypothetical mail server might be mymail.somecollege.edu. <br> <br>

**2. Network Enumeration - SMB**
  - List all SMB related script on NMAP. `ls /usr/share/nmap/scripts/ | grep smb`
  - `nmap -Pn --script smb-enum* -p139,445 IP | tee smb-enumeration`
  - `nmap -Pn --script smb-vuln* -p139,445 IP | tee smb-vulnerabilities`

  - SMB Enumerations with smbclient : `smbclient -L IP`
    - Try to access the drive : `smbclient \\\\IP\\DriveName`
  
  - SMB Enumerations with smbmap : `smbmap -H IP` <br><br>
  
**3. Domain Enumeration - windapsearch**
- [windapsearch](https://github.com/ropnop/windapsearch) is a python script to enumerate users, groups and computers from windows domain through LDAP.
- Enumerate Users without credentials
  - `python3 windapsearch -d <Domain Name> --dc-ip <Domain Controller IP> -U | tee windapsearch-enumeration-users`
- Enumerate Users with credentials
  - `python3 windapsearch -d <Domain Name> --dc-ip <Domain Controller IP> -u "domain\\username" -p "password" -U | tee winapsearch-authenticated-enumerations`
- Enumerate Groups with credentials
  - `python3 windapsearch -d <Domain Name> --dc-ip <Domain Controller IP> -u "domain\\username" -p "password" -G | tee winapsearch-authentication-group-enumerations`
- Enumerate unconstrained computers
  - `python3 windapsearch -d <Domain Name> --dc-ip <Domain Controller IP> -u "domain\\username" -p "password" --unconstrained-computers | tee unconstrained-computers-enumeration`
  - Unconstrained means that the computer is going to be able to impersonate anybody, if they have the hases for that. We can have the domain admin connected to these unconstrained comupter from there we can impersonate that as the domain admin.<br><br>

**4. Domain Enumeration - LdapDomainDump**
- [LdapDomainDump](https://github.com/dirkjanm/ldapdomaindump) is a tool to enumerate users, groups and computers. A better tool than windapsearch.
- `python3 ldapdomaindump.py --user "domain\\user" -p "password" ldap://DomainControllerIP:389 --no-json --no-grep -o output`
- The result can be seen on output directory. Make a output directory before running the above commands. <br><br>

**5. Domain Enumeration - Enumerating with Enum4Linux**
- Use cases
  - RID cycling (when RestrictAnonyomous is set to 1 on Windows 2000) 
  - User Listing (when RestrictAnonymous is set to 0 on Windows 2000)
  - Listing of group memebership information.
  - Share enumeration
  - Detecting if host in a workgroup or domain
  - Identifying the remote operating system
  - Password policy retrieval (using polenum)
- The Do Everything option
  - `enum4linux -a <IP>`. Here the IP is Domain Controller
- The Do Everything option with authentication
  - `enum4linux -u username -p password -a <IP>`
- List of usernames
  - `enum4linux -U <IP>`
- List of usernames with authentication
  - `enum4linux -u username -p password -U <IP>`
- Group Membership
  - `enum4linux -G IP`
- Group nbtstat Information
  - `enum4linux -n IP`
- Listing Windows shares
  - `enum4linux -S IP`
- Getting Printer Information
  - `enum4linux -i iP`
- Note down the Domain info like domain names, users and passwords, domain sid <br><br>

**6. Domain Enumeration NMAP Users**
- Using LDAP
  - `nmap -p389 --script ldap-search --script-args 'ldap.username="cn=ippsec,cn=users,dc=pentesting,dc=local",ldap.password=Password12345,ldap.qfilter=users,ldap.attrib=sAMAccountName' <IP> -Pn -oA nmap/domain-users`
  - Where domain name = pentestig.local, username=ippsec, password=Password12345.
  - It will list all the available users on the domain.
  - For enumerating groups, change `cn=users` to `cn=groups` and `ldap.qfilter=users` to `ldap.qfilter=groups` from the above commands<br><br>
- Using Kerberos
  - `nmap -p88 --script=krb5-enum-users --script-args krb5-enum-users.realm='pentesting.local' <IP> -Pn` -> Anonymous enumeration <br><br>
  
**7. Domain Enumeration GetADUsers.py**

**8. SwisArmy CrackMapExec Intro**



